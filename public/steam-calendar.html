<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Steam Calendar - Automation Hub</title>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Rajdhani', sans-serif;
      background: #000000;
      color: #FFFFFF;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }

    .grid-background {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        repeating-linear-gradient(0deg, transparent, transparent 50px, rgba(0, 128, 255, 0.03) 50px, rgba(0, 128, 255, 0.03) 51px),
        repeating-linear-gradient(90deg, transparent, transparent 50px, rgba(0, 128, 255, 0.03) 50px, rgba(0, 128, 255, 0.03) 51px);
      animation: gridMove 20s linear infinite;
      z-index: 0;
    }

    @keyframes gridMove {
      0% { transform: translate(0, 0); }
      100% { transform: translate(50px, 50px); }
    }

    .holographic-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 50% 50%, rgba(0, 128, 255, 0.05) 0%, transparent 70%);
      pointer-events: none;
      z-index: 1;
      animation: pulse 4s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    .back-button-container {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
    }

    .back-button {
      background: transparent;
      color: #00D4FF;
      border: 2px solid #00D4FF;
      padding: 12px 24px;
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 2px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      font-family: 'Rajdhani', sans-serif;
    }

    .back-button:hover {
      background: rgba(0, 212, 255, 0.1);
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
      transform: translateX(-5px);
    }

    .steam-container {
      position: relative;
      z-index: 2;
      padding: 100px 7.6923% 80px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .steam-header {
      display: flex;
      align-items: center;
      gap: 40px;
      margin-bottom: 60px;
    }

    .page-title {
      font-size: 32px;
      font-weight: 700;
      letter-spacing: 6px;
      color: #FFFFFF;
      text-transform: uppercase;
    }

    .main-grid {
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: 60px;
    }

    .main-card {
      position: relative;
      background: rgba(0, 20, 40, 0.4);
      backdrop-filter: blur(20px);
      padding: 60px;
      border: 2px solid rgba(0, 212, 255, 0.3);
      box-shadow: 
        0 0 60px rgba(0, 212, 255, 0.2),
        inset 0 0 40px rgba(0, 212, 255, 0.1);
    }

    .card-border-top,
    .card-border-right,
    .card-border-bottom,
    .card-border-left {
      position: absolute;
      background: linear-gradient(90deg, transparent 0%, #00D4FF 50%, transparent 100%);
      animation: borderScan 3s linear infinite;
    }

    .card-border-top {
      top: 0;
      left: 0;
      width: 100%;
      height: 2px;
    }

    .card-border-right {
      top: 0;
      right: 0;
      width: 2px;
      height: 100%;
      background: linear-gradient(180deg, transparent 0%, #00D4FF 50%, transparent 100%);
      animation-delay: 0.75s;
    }

    .card-border-bottom {
      bottom: 0;
      left: 0;
      width: 100%;
      height: 2px;
      animation-delay: 1.5s;
    }

    .card-border-left {
      top: 0;
      left: 0;
      width: 2px;
      height: 100%;
      background: linear-gradient(180deg, transparent 0%, #00D4FF 50%, transparent 100%);
      animation-delay: 2.25s;
    }

    @keyframes borderScan {
      0% { opacity: 0.3; }
      50% { opacity: 1; }
      100% { opacity: 0.3; }
    }

    .card-icon-large {
      text-align: center;
      margin-bottom: 30px;
    }

    .icon-calendar {
      font-size: 64px;
      color: #00D4FF;
      animation: iconFloat 3s ease-in-out infinite;
    }

    @keyframes iconFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    .card-heading {
      font-size: 28px;
      font-weight: 600;
      letter-spacing: 3px;
      text-align: center;
      margin-bottom: 16px;
      color: #FFFFFF;
    }

    .card-subheading {
      font-size: 16px;
      text-align: center;
      color: rgba(255, 255, 255, 0.6);
      margin-bottom: 50px;
      line-height: 1.6;
    }

    .form-group {
      margin-bottom: 30px;
    }

    .form-label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 2px;
      color: #00D4FF;
      text-transform: uppercase;
      margin-bottom: 12px;
    }

    .form-label-icon {
      font-size: 16px;
    }

    .form-input {
      width: 100%;
      padding: 16px 20px;
      background: rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(0, 212, 255, 0.3);
      border-radius: 0;
      color: #FFFFFF;
      font-size: 15px;
      font-family: 'Rajdhani', sans-serif;
      transition: all 0.3s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: #00D4FF;
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
      background: rgba(0, 0, 0, 0.7);
    }

    .form-input::placeholder {
      color: rgba(255, 255, 255, 0.3);
    }

    .submit-button {
      width: 100%;
      padding: 18px 32px;
      background: transparent;
      color: #00D4FF;
      border: 2px solid #00D4FF;
      border-radius: 0;
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 2px;
      cursor: pointer;
      transition: all 0.4s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      position: relative;
      overflow: hidden;
      font-family: 'Rajdhani', sans-serif;
    }

    .submit-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: rgba(0, 212, 255, 0.2);
      transition: left 0.4s ease;
    }

    .submit-button:hover::before {
      left: 0;
    }

    .submit-button:hover:not(:disabled) {
      box-shadow: 0 0 30px rgba(0, 212, 255, 0.6);
      transform: translateY(-2px);
    }

    .submit-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .spinner {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .result-panel {
      margin-top: 40px;
      padding: 30px;
      background: rgba(0, 212, 255, 0.1);
      border: 2px solid #00D4FF;
      display: none;
      animation: resultFadeIn 0.5s ease;
    }

    .result-panel.show {
      display: flex;
      gap: 20px;
    }

    @keyframes resultFadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .result-icon {
      flex-shrink: 0;
      width: 48px;
      height: 48px;
      background: #00D4FF;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #000000;
      font-size: 24px;
    }

    .result-info {
      flex: 1;
    }

    .result-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #FFFFFF;
    }

    .result-detail {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 4px;
    }

    .result-status {
      font-size: 14px;
      color: #00D4FF;
      margin-top: 12px;
      font-weight: 600;
    }

    .result-panel.error {
      background: rgba(255, 0, 0, 0.1);
      border-color: #ff0040;
    }

    .result-panel.error .result-icon {
      background: #ff0040;
    }

    .result-panel.error .result-status {
      color: #ff0040;
    }

    .info-panel {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .info-item {
      display: flex;
      gap: 20px;
      padding: 24px;
      background: rgba(0, 20, 40, 0.4);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 212, 255, 0.2);
      transition: all 0.3s ease;
      opacity: 0;
      animation: itemFadeIn 0.6s ease forwards;
    }

    .info-item:nth-child(1) { animation-delay: 0s; }
    .info-item:nth-child(2) { animation-delay: 0.1s; }
    .info-item:nth-child(3) { animation-delay: 0.2s; }

    @keyframes itemFadeIn {
      from {
        opacity: 0;
        transform: translateX(20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .info-item:hover {
      border-color: #00D4FF;
      box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
    }

    .info-number {
      flex-shrink: 0;
      width: 48px;
      height: 48px;
      background: transparent;
      border: 2px solid #00D4FF;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 700;
      color: #00D4FF;
    }

    .info-text h4 {
      font-size: 17px;
      font-weight: 600;
      margin-bottom: 8px;
      color: #FFFFFF;
      letter-spacing: 1px;
    }

    .info-text p {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.6);
      line-height: 1.5;
    }

    .landing-footer {
      position: relative;
      z-index: 2;
      padding: 40px 7.6923% 60px;
      margin-top: 100px;
    }

    .footer-divider {
      width: 100%;
      height: 1px;
      background: linear-gradient(90deg, transparent 0%, #00D4FF 50%, transparent 100%);
      margin-bottom: 40px;
    }

    .footer-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }

    .footer-logo {
      margin-bottom: 20px;
    }

    .footer-logo-img {
      height: 60px;
      opacity: 0.9;
      transition: all 0.3s ease;
    }

    .footer-logo-img:hover {
      opacity: 1;
      filter: drop-shadow(0 0 15px rgba(0, 212, 255, 0.6));
      transform: scale(1.05);
    }

    .footer-text {
      text-align: center;
    }

    .footer-text p {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.5);
      letter-spacing: 1px;
    }

    @media (max-width: 1024px) {
      .main-grid {
        grid-template-columns: 1fr;
        gap: 40px;
      }
    }

    @media (max-width: 768px) {
      .steam-container {
        padding: 80px 20px 60px;
      }

      .steam-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 20px;
      }

      .page-title {
        font-size: 22px;
        letter-spacing: 3px;
      }

      .main-card {
        padding: 30px 20px;
      }

      .card-heading {
        font-size: 22px;
      }

      .info-item {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="grid-background"></div>
  <div class="holographic-overlay"></div>

  <!-- Bouton retour au Hub -->
  <div class="back-button-container">
    <a href="/" class="back-button">‚Üê Retour au Hub</a>
  </div>

  <div class="steam-container">
    <div class="steam-header">
      <h1 class="page-title">Steam Calendar Sync</h1>
    </div>

    <div class="main-grid">
      <!-- Carte principale -->
      <div class="main-card">
        <div class="card-border-top"></div>
        <div class="card-border-right"></div>
        <div class="card-border-bottom"></div>
        <div class="card-border-left"></div>

        <div class="card-icon-large">
          <div class="icon-calendar">üìÖ</div>
        </div>

        <h2 class="card-heading">Synchroniser les dates de sortie Steam</h2>
        <p class="card-subheading">
          Collez un lien de jeu Steam pour cr√©er automatiquement un √©v√©nement de calendrier
        </p>

        <form id="steamForm" onsubmit="handleSubmit(event)">
          <div class="form-group">
            <label class="form-label">
              <span class="form-label-icon">üîó</span>
              URL du jeu Steam
            </label>
            <input 
              type="text" 
              id="steamUrl" 
              class="form-input" 
              placeholder="https://store.steampowered.com/app/1174180/Red_Dead_Redemption_2/"
              required
            >
          </div>

          <button type="submit" class="submit-button" id="submitBtn">
            <span id="btnText">üìÖ Cr√©er l'√©v√©nement calendrier</span>
            <span id="btnSpinner" class="spinner" style="display: none;">‚ü≥</span>
          </button>
        </form>

        <div id="resultPanel" class="result-panel">
          <div class="result-icon" id="resultIcon">‚úì</div>
          <div class="result-info">
            <div class="result-title" id="resultTitle">√âv√©nement cr√©√© avec succ√®s</div>
            <div class="result-detail" id="resultDetail">Le jeu a √©t√© ajout√© √† votre calendrier</div>
            <div class="result-status" id="resultStatus">‚óè Synchronis√© avec Google Calendar</div>
          </div>
        </div>
      </div>

      <!-- Panneau d'information -->
      <div class="info-panel">
        <div class="info-item">
          <div class="info-number">01</div>
          <div class="info-text">
            <h4>Copier le lien Steam</h4>
            <p>Trouvez un jeu sur Steam et copiez son URL</p>
          </div>
        </div>

        <div class="info-item">
          <div class="info-number">02</div>
          <div class="info-text">
            <h4>Coller & Traiter</h4>
            <p>Notre syst√®me analyse les donn√©es du jeu</p>
          </div>
        </div>

        <div class="info-item">
          <div class="info-number">03</div>
          <div class="info-text">
            <h4>Calendrier auto</h4>
            <p>√âv√©nement cr√©√© dans votre Google Calendar</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="landing-footer">
    <div class="footer-divider"></div>
    <div class="footer-content">
      <div class="footer-logo">
        <img src="https://drive.google.com/uc?export=view&id=1jwiHkCoHYDEf4R7ir91aELRmcyp_vwFk" alt="SoYour Corp" class="footer-logo-img">
      </div>
      <div class="footer-text">
        <p>¬© 2025 SoYour Corp. Tous droits r√©serv√©s.</p>
      </div>
    </div>
  </footer>

  <script>
// ========================================
// CONFIGURATION
// ========================================
// Pour activer le stockage Supabase des jeux sans date,
// remplissez ces variables (voir section Supabase plus bas dans le code)

const submitBtn = document.getElementById('submitBtn');
const btnText = document.getElementById('btnText');
const btnSpinner = document.getElementById('btnSpinner');
const resultPanel = document.getElementById('resultPanel');

async function handleSubmit(event) {
    event.preventDefault();
    
    const steamUrl = document.getElementById('steamUrl').value.trim();
    
    if (!steamUrl) {
        showError('Veuillez entrer une URL Steam valide');
        return;
    }
    
    submitBtn.disabled = true;
    btnText.style.display = 'none';
    btnSpinner.style.display = 'inline-block';
    
    try {
        // 1. R√©cup√©rer donn√©es Steam
        const steamResponse = await fetch('/.netlify/functions/steam-api', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ url: steamUrl })
        });
        
        const steamData = await steamResponse.json();
        
        if (!steamData.title) {
            throw new Error('Jeu introuvable');
        }
        
        // 2. Si date trouv√©e, ajouter au calendrier
        if (steamData.releaseDate) {
            const calendarResponse = await fetch('/.netlify/functions/google-calendar', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    title: steamData.title,
                    date: steamData.releaseDate,
                    description: `Page Steam : ${steamUrl}`
                })
            });
            
            const calendarData = await calendarResponse.json();
            
            if (calendarData.success) {
                showSuccess(`√âv√©nement cr√©√© : ${steamData.title}`, steamData.releaseDate);
            } else if (calendarData.exists) {
                showWarning(`√âv√©nement existe d√©j√† : ${steamData.title}`, steamData.releaseDate);
            }
        } else {
            // Pas de date - stocker dans Supabase
            const stored = await storeSteamGameInSupabase(steamData, steamUrl);
            if (stored) {
                showInfo(`${steamData.title}\nüìä Stock√© dans la base de donn√©es pour suivi ult√©rieur\nüîî Vous serez notifi√© quand une date sera disponible`);
            } else {
                showInfo(`${steamData.title}\n‚ö†Ô∏è Date √† d√©terminer`);
            }
        }
        
        document.getElementById('steamUrl').value = '';
        
    } catch (error) {
        showError('Erreur : ' + error.message);
    } finally {
        submitBtn.disabled = false;
        btnText.style.display = 'inline';
        btnSpinner.style.display = 'none';
    }
}
    function showSuccess(message, date) {
      var resultPanel = document.getElementById('resultPanel');
      var resultIcon = document.getElementById('resultIcon');
      var resultTitle = document.getElementById('resultTitle');
      var resultDetail = document.getElementById('resultDetail');
      var resultStatus = document.getElementById('resultStatus');

      resultPanel.classList.remove('error');
      resultPanel.classList.add('show');
      resultIcon.textContent = '‚úì';
      resultTitle.textContent = '√âv√©nement cr√©√© avec succ√®s';
      resultDetail.textContent = message;
      resultStatus.textContent = date ? '‚óè Date : ' + formatDate(date) : '‚óè Synchronis√© avec Google Calendar';
    }

    function showError(message) {
      var resultPanel = document.getElementById('resultPanel');
      var resultIcon = document.getElementById('resultIcon');
      var resultTitle = document.getElementById('resultTitle');
      var resultDetail = document.getElementById('resultDetail');
      var resultStatus = document.getElementById('resultStatus');

      resultPanel.classList.add('error');
      resultPanel.classList.add('show');
      resultIcon.textContent = '‚úó';
      resultTitle.textContent = 'Erreur';
      resultDetail.textContent = message;
      resultStatus.textContent = '‚óè √âchec de la synchronisation';
    }

    function showWarning(message, date) {
      var resultPanel = document.getElementById('resultPanel');
      var resultIcon = document.getElementById('resultIcon');
      var resultTitle = document.getElementById('resultTitle');
      var resultDetail = document.getElementById('resultDetail');
      var resultStatus = document.getElementById('resultStatus');

      resultPanel.classList.remove('error');
      resultPanel.classList.add('show');
      resultIcon.textContent = '‚ö†';
      resultTitle.textContent = '√âv√©nement existant';
      resultDetail.textContent = message;
      resultStatus.textContent = date ? '‚óè Date : ' + formatDate(date) : '‚óè D√©j√† dans le calendrier';
    }

    function showInfo(message) {
      var resultPanel = document.getElementById('resultPanel');
      var resultIcon = document.getElementById('resultIcon');
      var resultTitle = document.getElementById('resultTitle');
      var resultDetail = document.getElementById('resultDetail');
      var resultStatus = document.getElementById('resultStatus');

      resultPanel.classList.remove('error');
      resultPanel.classList.add('show');
      resultIcon.textContent = '‚Ñπ';
      resultTitle.textContent = 'Information';
      resultDetail.textContent = message;
      resultStatus.textContent = '‚óè Stock√© pour traitement ult√©rieur';
    }

    function formatDate(dateString) {
      try {
        const date = new Date(dateString);
        return date.toLocaleDateString('fr-FR', {
          weekday: 'long',
          year: 'numeric',
          month: 'long',
          day: 'numeric'
        });
      } catch (e) {
        return dateString;
      }
    }

    // ========================================
    // STOCKAGE SUPABASE via Netlify Function
    // ========================================
    async function storeSteamGameInSupabase(gameData, url) {
      try {
        // Extraire l'App ID de l'URL
        const match = url.match(/\/app\/(\d+)/);
        const appId = match ? match[1] : null;

        if (!appId) {
          console.error('‚ùå Impossible d\'extraire l\'App ID');
          return false;
        }

        // Appeler la Netlify Function
        const response = await fetch('/.netlify/functions/store-steam-game', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            appId: appId,
            title: gameData.title,
            releaseDate: gameData.releaseDate || null,
            url: url
          })
        });

        const result = await response.json();

        if (result.success) {
          if (result.alreadyExists) {
            console.log('‚ÑπÔ∏è Jeu d√©j√† en base de donn√©es');
          } else {
            console.log('‚úÖ Jeu stock√© dans Supabase');
          }
          return true;
        } else {
          console.error('‚ùå Erreur stockage:', result.error);
          return false;
        }

      } catch (error) {
        console.error('‚ùå Erreur storeSteamGameInSupabase:', error);
        return false;
      }
    }
  </script>
</body>
</html>
